<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Virtual Diary</title>
  <style>
    body {
      margin: 0;
      font-family: 'Georgia', serif;
      background-color: #e3d9c6;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }
    .diary {
      width: 90%;
      max-width: 800px;
      height: 90vh;
      background: #f8f1e7;
      border: 5px solid #a67c52;
      border-radius: 12px;
      box-shadow: 10px 10px 20px #5c3d26;
      position: relative;
      display: flex;
      flex-direction: column;
      padding: 10px;
      transition: transform 0.4s ease;
    }
    .header {
      background: #d4b483;
      color: #3b2f2f;
      padding: 0.5rem 1rem;
      font-size: 1.2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-weight: bold;
      border-bottom: 2px solid #a67c52;
      border-radius: 6px;
    }
    .page {
      flex: 1;
      padding: 1rem;
      background: url('https://www.transparenttextures.com/patterns/paper-fibers.png');
      background-color: #fffaf0;
      font-size: 1rem;
      overflow-y: auto;
      border: 2px dashed #a67c52;
      margin-top: 10px;
      border-radius: 10px;
      transition: transform 0.4s ease, opacity 0.4s ease;
      transform-origin: center;
    }
    .footer {
      background: transparent;
      padding: 0.5rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .btn {
      padding: 0.4rem 1rem;
      background: #d4b483;
      border: 2px solid #a67c52;
      font-size: 0.9rem;
      cursor: pointer;
      border-radius: 6px;
    }
    #popup {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: #fffaf0;
      padding: 1rem;
      border: 3px double #a67c52;
      display: none;
      z-index: 10;
      width: 300px;
      border-radius: 10px;
    }
    #overlay {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.3);
      display: none;
      z-index: 5;
    }
    textarea, input {
      width: 100%;
      margin-bottom: 0.5rem;
      font-family: 'Georgia';
      font-size: 1rem;
      border: 1px solid #a67c52;
      border-radius: 4px;
    }
    input {
      height: 30px;
    }
    textarea {
      height: 100px;
    }
  </style>
</head>
<body>
  <div class="diary">
    <div class="header">
      <span id="date">Loading...</span>
      <button class="btn" onclick="showPopup()">+ Add Thought</button>
    </div>
    <div class="page" id="pageContent">
      Loading thoughts...
    </div>
    <div class="footer">
      <button class="btn" id="prevBtn">⬅️ Previous Day</button>
      <button class="btn" id="nextBtn">Next Day ➡️</button>
    </div>
  </div>

  <div id="overlay"></div>
  <div id="popup">
    <input type="text" id="nameInput" placeholder="Your name..." />
    <textarea id="thoughtInput" placeholder="Write your thought..."></textarea>
    <button class="btn" onclick="saveThought()">Submit</button>
  </div>

  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
 <script>
  const firebaseConfig = {
    apiKey: "AIzaSyB4eoofAdY4DrW-VKvfGJl5aNv2hoCTn4c",
    authDomain: "iist-fd6e8.firebaseapp.com",
    databaseURL: "https://iist-fd6e8-default-rtdb.firebaseio.com",
    projectId: "iist-fd6e8",
    storageBucket: "iist-fd6e8.appspot.com",
    messagingSenderId: "692699808449",
    appId: "1:692699808449:web:120c8941a940d071f24a40"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  const dateElem = document.getElementById('date');
  const pageContent = document.getElementById('pageContent');
  const prevBtn = document.getElementById('prevBtn');
  const nextBtn = document.getElementById('nextBtn');

  let pages = {};
  let currentDate = new Date(); // <-- Track the active date

  function formatDate(date) {
    return date.toDateString();
  }

  function showPopup() {
    document.getElementById('overlay').style.display = 'block';
    document.getElementById('popup').style.display = 'block';
  }

  function hidePopup() {
    document.getElementById('overlay').style.display = 'none';
    document.getElementById('popup').style.display = 'none';
  }

  function saveThought() {
    const name = document.getElementById('nameInput').value.trim();
    const thought = document.getElementById('thoughtInput').value.trim();
    if (name === '' || thought === '') return;

    const timestamp = Date.now();
    db.ref('diary/' + timestamp).set({
      name: name,
      date: currentDate.toISOString(),
      content: thought
    }).then(() => {
      hidePopup();
      document.getElementById('nameInput').value = '';
      document.getElementById('thoughtInput').value = '';
      loadThoughts(); // Refresh entries
    });
  }

  function loadThoughts() {
    db.ref('diary').once('value').then(snapshot => {
      const data = snapshot.val() || {};
      pages = {};

      // Sort and group entries by day
      Object.values(data).forEach(entry => {
        const dayStr = new Date(entry.date).toDateString();
        if (!pages[dayStr]) pages[dayStr] = [];
        pages[dayStr].push(entry);
      });

      showPage(currentDate);
    });
  }

  function showPage(dateObj) {
    const dateStr = formatDate(dateObj);
    dateElem.textContent = dateStr;

    const entries = pages[dateStr] || [];

    pageContent.style.transition = 'none';
    pageContent.style.transform = 'rotateY(-90deg)';
    pageContent.style.opacity = 0;

    setTimeout(() => {
      let html = "";
      if (entries.length === 0) {
        html = "<p><em>No thoughts for this day yet.</em></p>";
      } else {
        entries.forEach(entry => {
          html += `<p><strong>${entry.name}</strong>: ${entry.content}</p>`;
        });
      }
      pageContent.innerHTML = html;
      pageContent.style.transition = 'transform 0.4s ease, opacity 0.4s ease';
      pageContent.style.transform = 'rotateY(0deg)';
      pageContent.style.opacity = 1;
    }, 100);
  }

  prevBtn.addEventListener('click', () => {
    currentDate.setDate(currentDate.getDate() - 1);
    showPage(currentDate);
  });

  nextBtn.addEventListener('click', () => {
    currentDate.setDate(currentDate.getDate() + 1);
    showPage(currentDate);
  });

  loadThoughts();
</script>
